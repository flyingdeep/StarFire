<!doctype html>
<html>
<head>

    <title>找摊位</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <link rel="stylesheet" type="text/css" href="framework/appframework-master/build/icons.css" />
    <link rel="stylesheet" type="text/css" href="framework/appframework-master/build/af.ui.css" />
    <link rel="stylesheet" type="text/css" href="css/customize.css" />

    <script type="text/javascript" src="./js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="./js/fastclick.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?type=quick&ak=NpZPLFzDKjPWEenu8D2yf4vS&v=1.0"></script>

    <script type="text/javascript" src="./js/baidu/initial.js"></script>
    <script type="text/javascript" src="./js/config.js"></script>
    <script type="text/javascript" src="./js/class/remoteProxy.js"></script>
    <script type="text/javascript" src="./js/class/processFacade.js"></script>
    <script type="text/javascript" src="./js/class/commonHelper.js"></script>
    <script type="text/javascript" src="./js/baidu/lbscloud.js"></script>
    <script type="text/javascript" src="./js/baidu/maphelper.js"></script>



    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.shim.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.ui.js"></script>

    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.desktopBrowsers.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.actionsheet.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.animation.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.touchEvents.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.popup.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.drawer.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.toast.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.animateheader.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.splashscreen.js"></script>
    <script type="text/javascript" charset="utf-8" src="framework/appframework-master/src/af.swipereveal.js"></script>



    <script type="text/javascript">
        $.afui.useOSThemes=false;
        $.afui.loadDefaultHash=true;
        $.afui.autoLaunch=false;
        var commonHelper = new commonHelperClass();
        $(document).ready(function(){


            initialAction();

        });

        function initialAction()
        {
            FastClick.attach( document.body );
            if (!localStorage.position) {

                localStorage.position = "121.50,31.25";
            }
            localStorage.position = "121.50,31.25";
            currentPosition = localStorage.position;
            $.afui.launch();
        }
        var mapCenterString = null; //map center val



        //************************************ main map related**************************************
        var gc = new BMap.Geocoder();
        var mapCr =null;
        var map = null;


    </script>


</head>
<body>
<!----------------------   Main Map View --------------------->
<div class="view" id="mainView">
    <header id="mapHeader">
        <div style="float:left"><a href="#" class="icon info green button previous">个人信息</a></div>

        <div style="float:right"><a href="#" class="icon right green button next">摊位列表</a></div>
       <div class="titleDiv">摊位地图</div>
    </header>
    <div class="pages">

          <div class="panel zeroPadding"  id="mapPanel" data-selected="true">
              <div id="searchBar">
                  <div id="searchDiv"><form id="searchForm"><input id="searchInput" type="search" placeholder="搜索摊位"></form></div>
                  <div id="toggleDiv"><input id="toggleTarget" type="checkbox" checked=""  name="toggleTarget" value="1" class="toggle">
                  <label for="toggleTarget"  data-on="摊位" data-off="地址" class="toggleLabel"><span></span>
                  </label><br style="clear:both"></div>

                  <a  class="icon settings" id="filterSettingIcon"  onclick="$.afui.drawer.show('#right_Filter','right')"></a>
              </div>
              <div id="bottomBar">
              <div id="transparentShader"></div>
                  <div class="button-grouped">
                 <a href="#createStandPanel1" class="button  icon add" data-transition="pop">新增摊位</a>
                      <a href="#" class="button  icon folder">我的摊位</a>
                      <a href="#" class="button  icon heart">我的收藏</a>
                      </div>
              </div>

           <div id="mapContainer" class="mapCss"></div>
          </div>
    </div>

</div>


<!----------------------  搜索结果 --------------------->
<div class="view" id="searchResultListView">
    <header id="searchResultHeader" >
        <div style="padding:5px;">
            <form id="searchResultListForm">
                <div id="searchDivResultInner"><input  type="search" placeholder="搜索" style="color:black;"></div>
            </form>
        </div>
    </header>
    <div class="pages">
        <div class="panel"  id="searchResultListPanel">
                <div id="resultList">


                </div>
        </div>
    </div>


</div>

<!----------------------   创建摊位 - 1 --------------------->
<div class="view" id="createStandView1">
    <header id="createStandHeader1">
        <div style="float:left"><a href="#mapPanel" data-transition="up" class="icon close green button previous">放弃</a></div>
        <div style="float:right"><a href="#createStandPanel2" data-transition="slide" class="icon right green button next">下一步</a></div>
        <div class="titleDiv">新建摊位-基本信息</div>
    </header>
    <div class="pages">
        <div class="panel panelPadding"  id="createStandPanel1">

            <form>
                    <div>摊位名:</div><br>
                    <div><input id="standName" type="text" placeholder="不超过十个字"></div>
                    <div>类型:</div>
                <div id="standTypeDiv" class="grid"></div><br>
                    <div>子分类:</div><br>
                <div><input id="subStandType" type="text" placeholder="多子分类以逗号隔开。 如： 蛋饼，葱油饼，臭豆腐
"></div>
                    <div>描述:</div><br>
                <div><textarea id="test3" rows="6" placeholder="描述摊位特色，来由或任何细节信息，不超过200字
"></textarea></div>
            </form>
        </div>
     </div>


</div>
<!----------------------   创建摊位 - 2 --------------------->
<div class="view" id="createStandView2">
    <header id="createStandHeader2">
       <div style="float:left"><a href="#createStandPanel1" data-transition="invoke"  class="icon left green button previous">上一步</a></div>
      <div style="float:right"><a href="#" data-transition="slide" class="icon right green button next">下一步</a></div>
      <div class="titleDiv">新建摊位-选择位置</div>
  </header>
  <div class="pages">
      <div class="panel zeroPadding"  id="createStandPanel2">
          <div style="position: absolute;top:3px;width:100%;left:2px;z-index: 50" >
              <div id="searchDivInner" style="float:left;"><input  type="search" placeholder="搜索地址以定位区域"></div>
              <br style="clear:both">
              <div ><div style="float:right;">设置摊位为当前位置<a></a></div>
                  <br style="clear:both">
                  <div style="float:right;">
                      附近摊位<input id="displayStandInput" type="checkbox" checked=""  name="displayStandInput" value="1" class="toggle">
                      <label for="displayStandInput"  data-on="显示" data-off="隐藏" class="toggleLabel"><span></span>
                      </label>
                  </div>
              </div>
          </div>
          <div id="mapContainerCr" class="mapCss"></div>
      </div>
  </div>


</div>

<!---------------------  右侧菜单  -------------------------------->
<nav id="right_Filter" style="width:90%">
<div class="view active">
    <header>
        <h1>筛选设置</h1>
    </header>
    <div class="pages">
        <div class="panel active" id="filterPanel">
            <div  class="input-group">
                <div  class="grid">
                    <div class="gcol2 filterLineCss">显示距离:</div><div class="gcol2 filterLineCss">&nbsp;</div>
                    <div class="gcol2"><input id="distantRadio200" type="radio"  name="distantRadio200" value="200"><label for="distantRadio200">200米</label></div>
                    <div class="gcol2"><input id="distantRadio500" type="radio"  name="distantRadio500" value="500" selected><label for="distantRadio500">500米</label></div>
                    <div class="gcol2"><input id="distantRadio1000" type="radio"  name="distantRadio1000" value="1000"><label for="distantRadio1000">1000米</label></div>
                    <div class="gcol2"><input id="distantRadio2000" type="radio"  name="distantRadio2000" value="2000"><label for="distantRadio2000">2000米</label></div>
                    &nbsp;
                </div><br />
               <div id="toggleCustomCrStandDiv" class="grid">
                   <div class="gcol2 filterLineCss">显示非摊主创建摊位:</div>
                   <div class="gcol2 filterLineCss">
                       <input id="toggleCustomCrStandInput" type="checkbox" name="toggleCustomCrStandInput" value="1" class="toggle">
                    <label for="toggleCustomCrStandInput"  data-on="是" data-off="否"><span></span></label>
                    </div>
                </div>
                <div id="toggleFavoriteStandDiv" class="grid">
                    <div class="gcol2 filterLineCss">仅显示收藏摊位:</div>
                    <div class="gcol2 filterLineCss"><input id="toggleFavoriteStandInput" type="checkbox" name="toggleFavoriteStandInput" value="1" class="toggle">
                    <label for="toggleFavoriteStandInput"  data-on="是" data-off="否"><span></span></label>
                    </div>
                </div>
                 <div id="standDisplayModeDiv" class="grid" >
                     <div class="gcol2 filterLineCss">摊位显示方式:</div>
                     <div class="gcol2 filterLineCss" >
                     <input id="standDisplayModeInput" type="checkbox" name="standDisplayModeInput" value="1" class="toggle">
                    <label for="standDisplayModeInput"  data-on="是" data-off="否"><span></span></label>
                     </div>
                </div>
            </div><br />
            <div style="text-align: center;"><a data-menu-close class="button" >关闭</a></div>
        </div>
    </div>
</div>
</nav>

<script type="text/javascript">
    $("#toggleTarget").on("change",function()
    {
        if ($("#toggleTarget").prop("checked"))
        {
            $("#searchInput").prop("placeholder","搜索摊位");
        }
        else
        {
            $("#searchInput").prop("placeholder","搜索地址");
        }
    });
    $("#searchForm").on("submit",function()
    {
        if ($("#toggleTarget").prop("checked"))
        {
            searchStand();
        }
        else
        {
            searchLocation();
        }
        return false;
    });

    $("#filterPanel").on("swipeRight", function(){
        $.afui.drawer.hide("#right_Filter","right");
    });


    var toastObj = null;
    $(window).on("hashchange",function()
        {
            if (window.location.hash=="#createStandPanel1")
            {
                if ( $("#standTypeDiv").html() == "") {
                    commonHelper.constructStandTypeHTML(function (e) {
                        $("#standTypeDiv").html(e);
                    });
                }
            }
            if (window.location.hash=="#createStandPanel2")
            {

                if(!mapCr) {
                    mapCr = new BMap.Map("mapContainerCr");
                    mapCr.centerAndZoom(init_city);
                }
                    toastObj  = $.afui.toast({
                    message:"点击地图任意处以设定摊位位置",
                    position:"bc",
                    autoClose:false, //have to click the message to close
                    type:"success"
                });
            }
            else
            {
                if (toastObj)
                {
                    toastObj.hide();
                }
            }


        }
    );

    function searchLocation()
    {
        $("#resultList").html("");
        $.afui.loadContent("#searchResultListPanel",false,false,"pop");
        var searchString = $("#searchInput").val();
        $("#searchDivResultInner input").val(searchString);
        $("#searchResultListForm").on("submit",function()
         {
             var searchStringInner = $("#searchDivResultInner input").val();
             $("#searchInput").val(searchStringInner);
             searchLocalPosition(searchStringInner,map,$("#resultList"));
             return false;
         }
        );
        searchLocalPosition(searchString,map,$("#resultList"));
    }

    function searchStand()
    {
        $("#resultList").html("");
        $.afui.loadContent("#searchResultListPanel",false,false,"pop");
        var searchString = $("#searchInput").val();
        $("#searchDivResultInner input").val(searchString);
        $("#searchResultListForm").on("submit",function()
                {
                    var searchStringInner = $("#searchDivResultInner input").val();
                    $("#searchInput").val(searchStringInner);
                    searchPoiNearbyPosition(mapCenterString,searchStringInner,$("#resultList"));
                    return false;
                }
        );
        searchPoiNearbyPosition(mapCenterString,searchString,$("#resultList"));
    }
// map related =====================================================
    map = new BMap.Map("mapContainer");
    var init_city = "上海";

    var Json_tap_postion; //finger tap position return Json
    var Json_decode_postion2address; //get address from position
    var current_map_level;
    //map.centerAndZoom(new BMap.Point(CONST_POINT_X, CONST_POINT_Y), CONST_DISPLAY_LEVEL);
    map.centerAndZoom(init_city);

    var map_dragend_event = function (){

    };
    var map_click_event = function (e){
        var pt = e.point;
        Json_tap_postion =
        {
            "point_x":pt.lat ,
            "point_y": pt.lng
        };
        alert(Json_tap_postion.point_x + "  " + Json_tap_postion.point_y);
        gc.getLocation(pt, function(rs){
            var addComp = rs.addressComponents;
            Json_decode_postion2address = {
                "province": addComp.province,
                "city": addComp.city,
                "district": addComp.district,
                "street": addComp.street,
                "streetNumber": addComp.streetNumber
            };
        });
    };
    var map_zoomend_event = function (){
        current_map_level = map.getZoom();
    };

    var map_moveend_event = function (){
        mapCenterString = getMapCenter(map);
    };
    var map_load_event = function(){
        mapCenterString = getMapCenter(map);
    };

    // map.addEventListener("dragend", map_dragend_event);
    //map.addEventListener("click", map_click_event);
    //map.addEventListener("zoomend", map_zoomend_event);
    map.addEventListener("moveend", map_moveend_event);
    map.addEventListener("load", map_load_event);

</script>
</body>
</html>