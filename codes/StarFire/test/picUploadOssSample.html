<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../js/common/base64.js"></script>
    <script type="text/javascript" src="../js/config.js"></script>
    <script type="text/javascript" src="../js/class/remoteProxy.js"></script>
    <script type="text/javascript" src="../js/class/processFacade.js"></script>
    <script type="text/javascript" src="../js/class/commonHelper.js"></script>
    <script type="text/javascript" src="../js/common/imageUploadHelper.js"></script>
</head>
<body>
<form  method="post" action="http://flyingdeeptest.oss-cn-hangzhou.aliyuncs.com" enctype="multipart/form-data" >
    Key <input name="key" type="text" > <br>
    OSSAccessKeyId <input name="OSSAccessKeyId" type="text"  value="glMswMHjOFGZRlhz" ><br>
    Policy <input name="policy" type="text"  value='eyJleHBpcmF0aW9uIjoiMjAxNS0xMi0wMVQxMjowMDowMC4wMDBaIiwiY29uZGl0aW9ucyI6W1siY29udGVudC1sZW5ndGgtcmFuZ2UiLDEsNTI0Mjg4MF1dfQ==' ><br>
    Signature <input name="Signature" type="text"  value="X+SDfnmqlD0Jj4n7REbNEQ4QwUI=" ><br>
    File <input name="file" type="file" >

    <input type="submit"  value="Submit" >
</form>

<form id="uploadStandImageForm" >
     <input id="key" name="key" type="hidden"> <br>
     <input id="OSSAccessKeyId" name="OSSAccessKeyId" type="hidden"><br>
     <input id="policy" name="policy" type="text"><br>
     <input id="Signature" name="Signature" type="hidden"><br>
     <input id="file" name="file" type="file" accept="image/jpeg,image/png"  >
    <a href="#" onclick=uploadSingleStandImage >Submit</a>
    <img src="" id="previewImg" style="display:none">
</form>
<script>


    function uploadSingleStandImage()
    {
        var fileNameCode = generateOSSAutoFilenameCode(inputSeed);
        var commonHelper = new commonHelperClass();
        commonHelper.getOSSSignatureAndPolicy(function(e)
        {
            var OSSBase64Policy = e.base64policy;
            var OSSSignature = e.signature;
            var uploadStandFormVal = $("#uploadStandImageForm");
            uploadStandFormVal.prop("method","post");
            uploadStandFormVal.prop("action",OSS_DOMAIN);
            uploadStandFormVal.prop("enctype",OSS_ENCTYPE);
            $("#key").val("");
            $("#OSSAccessKeyId").val(OSS_ACCESS_KEY_ID);
            $("#policy").val(OSSBase64Policy);
            $("#Signature").val(OSSSignature);
            uploadStandFormVal.submit();
        });

    }
    var inputSeed = 0;
    function handleFileSelect (evt) {
        inputSeed = (new Date()).getTime();
        var files = evt.target.files;
        for (var i = 0, f; f = files[i]; i++) {
            // Only process image files.
            if (!f.type.match('image.*')) {
                continue;
            }
            alert(f.size);
            var reader = new FileReader();
            // Closure to capture the file information.
            reader.onload = (function(theFile) {
                return function(e) {
                    // Render thumbnail.
                    var i = document.getElementById("previewImg");
                    i.src = event.target.result;
                    var imgWidth = document.body.clientWidth*0.7;
                    if ($(i).width()<imgWidth)
                    {
                        imgWidth = $(i).width;
                    }
                    $(i).css('width',imgWidth+'px');
                    var quality =  50;
                    i.src = jic.compress(i,quality).src;
                    i.style.display = "block";
                };
            })(f);
            // Read in the image file as a data URL.
            reader.readAsDataURL(f);
        }
    }
    document.getElementById('file').addEventListener('change', handleFileSelect, false);
</script>
</body>
</html>